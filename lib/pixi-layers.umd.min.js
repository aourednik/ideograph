/* eslint-disable */
this.PIXI=this.PIXI||{},this.PIXI.display=this.PIXI.display||{},function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@pixi/display"),require("@pixi/core"),require("@pixi/math"),require("@pixi/utils"),require("@pixi/settings")):"function"==typeof define&&define.amd?define(["exports","@pixi/display","@pixi/core","@pixi/math","@pixi/utils","@pixi/settings"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)._pixi_layers={},e.PIXI,e.PIXI,e.PIXI,e.PIXI.utils,e.PIXI)}(this,(function(e,t,r,i,s,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var h=a(s);function l(e){return function(t){this._activeParentLayer&&this._activeParentLayer!==t._activeLayer||(this.visible?(this.displayOrder=t.incDisplayOrder(),this.worldAlpha<=0||!this.renderable||(t._activeLayer=null,e.call(this,t),t._activeLayer=this._activeParentLayer)):this.displayOrder=0)}}function u(e){this._activeParentLayer&&this._activeParentLayer!==e._activeLayer||(this.visible?(this.displayOrder=e.incDisplayOrder(),this.worldAlpha<=0||!this.renderable||(e._activeLayer=null,this.containerRenderWebGL(e),e._activeLayer=this._activeParentLayer)):this.displayOrder=0)}function o(){if(void 0!==t.DisplayObject.prototype.displayOrder)return;Object.assign(t.DisplayObject.prototype,{parentLayer:null,_activeParentLayer:null,parentGroup:null,zOrder:0,zIndex:0,updateOrder:0,displayOrder:0,layerableChildren:!0,isLayer:!1});const e=t.Container.prototype;e.containerRenderWebGL=e.render,e.render=u}class d{constructor(){this._tempPoint=new i.Point,this._queue=[[],[]],this._eventDisplayOrder=0,this.worksWithLayers=!0}recursiveFindHit(e,t,r,i,s){if(!t||!t.visible)return 0;let n=0,a=i=t.interactive||i;t.hitArea&&(a=!1),t._activeParentLayer&&(s=!1);const h=t._mask;r<1/0&&h&&(h.containsPoint(e)||(s=!0)),r<1/0&&t.filterArea&&(t.filterArea.contains(e.x,e.y)||(s=!0));const l=t.children;if(t.interactiveChildren&&l)for(let t=l.length-1;t>=0;t--){const i=l[t],h=this.recursiveFindHit(e,i,r,a,s);if(h){if(!i.parent)continue;n=h,r=h}}return i&&(s?t.interactive&&this._queueAdd(t,0):(r<t.displayOrder&&(t.hitArea?(t.worldTransform.applyInverse(e,this._tempPoint),t.hitArea.contains(this._tempPoint.x,this._tempPoint.y)&&(n=t.displayOrder)):t.containsPoint&&t.containsPoint(e)&&(n=t.displayOrder)),t.interactive&&this._queueAdd(t,n===1/0?0:n))),n}findHit(e,t,r,i){const s=e.data.global;this._startInteractionProcess(),this.recursiveFindHit(s,t,i?0:1/0,!1,!1),this._finishInteractionProcess(e,r)}_startInteractionProcess(){this._eventDisplayOrder=1,this._queue||(this._queue=[[],[]]),this._queue[0].length=0,this._queue[1].length=0}_queueAdd(e,t){const r=this._queue;if(t<this._eventDisplayOrder)r[0].push(e);else{if(t>this._eventDisplayOrder){this._eventDisplayOrder=t;const e=r[1];for(let t=0,i=e.length;t<i;t++)r[0].push(e[t]);r[1].length=0}r[1].push(e)}}_finishInteractionProcess(e,t){const r=this._queue;let i=r[0];for(let r=0,s=i.length;r<s;r++)t(e,i[r],!1);i=r[1];for(let r=0,s=i.length;r<s;r++)e.target||(e.target=i[r]),t&&t(e,i[r],!0)}}function c(e){const t=e.prototype;var i;t._oldRender||(Object.assign(t,{_lastDisplayOrder:0,_activeLayer:null,incDisplayOrder(){return++this._lastDisplayOrder},_oldRender:r.Renderer.prototype.render}),t._oldRender=t.render,t.render=(i=t.render,function(e,t,r,s,n){t&&(t.renderTexture||t.baseTexture)||(this._lastDisplayOrder=0),this._activeLayer=null,e.isStage&&e.updateStage(),this.plugins.interaction&&!this.plugins.interaction.search.worksWithLayers&&(this.plugins.interaction.search=new d),i.call(this,e,t,r,s,n)}))}class p extends h.EventEmitter{constructor(e=0,t=!1){super(),this.useRenderTexture=!1,this.useDoubleBuffer=!1,this.sortPriority=0,this.clearColor=new Float32Array([0,0,0,0]),this.canDrawWithoutLayer=!1,this.canDrawInParentStage=!0,this._activeLayer=null,this._activeStage=null,this._activeChildren=[],this._lastUpdateId=-1,this.zIndex=e||0,this.enableSort=!!t,"function"==typeof t&&this.on("sort",t)}doSort(e,t){if(this.listeners("sort",!0))for(let e=0;e<t.length;e++)this.emit("sort",t[e]);t.sort(p.compareZIndex)}static compareZIndex(e,t){return e.zOrder<t.zOrder?-1:e.zOrder>t.zOrder?1:e.updateOrder-t.updateOrder}clear(){this._activeLayer=null,this._activeStage=null,this._activeChildren.length=0}_resolveChildDisplayObject(e,t){this.check(e),t._activeParentLayer=this._activeLayer,this._activeLayer?this._activeLayer._activeChildren.push(t):this._activeChildren.push(t)}_resolveLayer(e,t){this.check(e),this._activeLayer&&p.conflict(),this._activeLayer=t,this._activeStage=e}check(e){if(this._lastUpdateId<p._layerUpdateId)this._lastUpdateId=p._layerUpdateId,this.clear(),this._activeStage=e;else if(this.canDrawInParentStage){let t=this._activeStage;for(;t&&t!==e;)t=t._activeParentStage;this._activeStage=t,null===t&&this.clear()}}static conflict(){p._lastLayerConflict+5e3<Date.now()&&(p._lastLayerConflict=Date.now(),console.log("@pixi/layers found two layers with the same group in one stage - that's not healthy. Please place a breakpoint here and debug it"))}}p._layerUpdateId=0,p._lastLayerConflict=0;class f{constructor(e){this.layer=e,this.renderTexture=null,this.doubleBuffer=null,this.currentBufferIndex=0,this._tempRenderTarget=null,this._tempRenderTargetSource=new i.Rectangle,this._tempRenderTargetDestination=new i.Rectangle}init(e){const t=e?e.screen.width:100,i=e?e.screen.height:100,s=e?e.resolution:n.settings.RESOLUTION;this.renderTexture=r.RenderTexture.create({width:t,height:i,resolution:s}),this.layer.group.useDoubleBuffer&&(this.doubleBuffer=[r.RenderTexture.create({width:t,height:i,resolution:s}),r.RenderTexture.create({width:t,height:i,resolution:s})])}getRenderTexture(){return this.renderTexture||this.init(),this.renderTexture}pushTexture(e){const t=e.screen;this.renderTexture||this.init(e);const r=this.renderTexture,i=this.layer.group,s=this.doubleBuffer;if(r.width===t.width&&r.height===t.height&&r.baseTexture.resolution===e.resolution||(r.baseTexture.resolution=e.resolution,r.resize(t.width,t.height),s&&(s[0].baseTexture.resolution=e.resolution,s[0].resize(t.width,t.height),s[1].baseTexture.resolution=e.resolution,s[1].resize(t.width,t.height))),s&&(s[0].framebuffer.multisample=r.framebuffer.multisample,s[1].framebuffer.multisample=r.framebuffer.multisample),this._tempRenderTarget=e.renderTexture.current,this._tempRenderTargetSource.copyFrom(e.renderTexture.sourceFrame),this._tempRenderTargetDestination.copyFrom(e.renderTexture.destinationFrame),e.batch.flush(),i.useDoubleBuffer){let t=s[this.currentBufferIndex];t.baseTexture._glTextures[e.CONTEXT_UID]||(e.renderTexture.bind(t,void 0,void 0),e.texture.bind(t),i.clearColor&&e.renderTexture.clear(i.clearColor)),e.texture.unbind(r.baseTexture),r.baseTexture._glTextures=t.baseTexture._glTextures,r.baseTexture.framebuffer=t.baseTexture.framebuffer,t=s[1-this.currentBufferIndex],e.renderTexture.bind(t,void 0,void 0)}else e.renderTexture.bind(r,void 0,void 0);i.clearColor&&e.renderTexture.clear(i.clearColor);const n=e.filter.defaultFilterStack;n.length>1&&(n[n.length-1].renderTexture=e.renderTexture.current)}popTexture(e){e.batch.flush(),e.framebuffer.blit();const t=e.filter.defaultFilterStack;t.length>1&&(t[t.length-1].renderTexture=this._tempRenderTarget),e.renderTexture.bind(this._tempRenderTarget,this._tempRenderTargetSource,this._tempRenderTargetDestination),this._tempRenderTarget=null;const r=this.renderTexture,i=this.layer.group,s=this.doubleBuffer;if(i.useDoubleBuffer){e.texture.unbind(r.baseTexture),this.currentBufferIndex=1-this.currentBufferIndex;const t=s[this.currentBufferIndex];r.baseTexture._glTextures=t.baseTexture._glTextures,r.baseTexture.framebuffer=t.baseTexture.framebuffer}}destroy(){this.renderTexture&&(this.renderTexture.destroy(),this.doubleBuffer&&(this.doubleBuffer[0].destroy(!0),this.doubleBuffer[1].destroy(!0)))}}class y extends t.Container{constructor(e=null){super(),this.isLayer=!0,this.group=null,this._activeChildren=[],this._tempChildren=null,this._activeStageParent=null,this._sortedChildren=[],this._tempLayerParent=null,this.insertChildrenBeforeActive=!0,this.insertChildrenAfterActive=!0,e?(this.group=e,this.zIndex=e.zIndex):this.group=new p(0,!1),this._tempChildren=this.children}get useRenderTexture(){return this.group.useRenderTexture}set useRenderTexture(e){this.group.useRenderTexture=e}get useDoubleBuffer(){return this.group.useDoubleBuffer}set useDoubleBuffer(e){this.group.useDoubleBuffer=e}get clearColor(){return this.group.clearColor}set clearColor(e){this.group.clearColor=e}get sortPriority(){return this.group.sortPriority}set sortPriority(e){this.group.sortPriority=e}getRenderTexture(){return this.textureCache||(this.textureCache=new f(this)),this.textureCache.getRenderTexture()}doSort(){this.group.doSort(this,this._sortedChildren)}destroy(e){this.textureCache&&(this.textureCache.destroy(),this.textureCache=null),super.destroy(e)}render(e){this.prerender(e)&&(this.group.useRenderTexture&&(this.textureCache||(this.textureCache=new f(this)),this.textureCache.pushTexture(e)),this.containerRenderWebGL(e),this.postrender(e),this.group.useRenderTexture&&this.textureCache.popTexture(e))}renderCanvas(e){this.prerender(e)&&(this.containerRenderCanvas(e),this.postrender(e))}_onBeginLayerSubtreeTraversal(e){const t=this._activeChildren;this._activeStageParent=e,this.group._resolveLayer(e,this);const r=this.group._activeChildren;t.length=0;for(let e=0;e<r.length;e++)r[e]._activeParentLayer=this,t.push(r[e]);r.length=0}_onEndLayerSubtreeTraversal(){const e=this.children,t=this._activeChildren,r=this._sortedChildren;for(let e=0;e<t.length;e++)this.emit("display",t[e]);if(r.length=0,this.insertChildrenBeforeActive)for(let t=0;t<e.length;t++)r.push(e[t]);for(let e=0;e<t.length;e++)r.push(t[e]);if(!this.insertChildrenBeforeActive&&this.insertChildrenAfterActive)for(let t=0;t<e.length;t++)r.push(e[t]);this.group.enableSort&&this.doSort()}prerender(e){return(!this._activeParentLayer||this._activeParentLayer==e._activeLayer)&&(this.visible?(this.displayOrder=e.incDisplayOrder(),!(this.worldAlpha<=0||!this.renderable)&&(this.children!==this._sortedChildren&&this._tempChildren!==this.children&&(this._tempChildren=this.children),this._boundsID++,this.children=this._sortedChildren,this._tempLayerParent=e._activeLayer,e._activeLayer=this,!0)):(this.displayOrder=0,!1))}postrender(e){this.children=this._tempChildren,e._activeLayer=this._tempLayerParent,this._tempLayerParent=null}}class _ extends y{constructor(){super(...arguments),this.isStage=!0,this._tempGroups=[],this._activeLayers=[],this._activeParentStage=null}clear(){this._activeLayers.length=0,this._tempGroups.length=0}destroy(e){this.clear(),super.destroy(e)}updateStage(){this._activeParentStage=null,p._layerUpdateId++,this._updateStageInner()}updateAsChildStage(e){this._activeParentStage=e,_._updateOrderCounter=0,this._updateStageInner()}_updateStageInner(){this.clear(),this._addRecursive(this);const e=this._activeLayers;for(let t=0;t<e.length;t++){const r=e[t];if(r.group.sortPriority){r._onEndLayerSubtreeTraversal();const e=r._sortedChildren;for(let t=0;t<e.length;t++)this._addRecursiveChildren(e[t])}}for(let t=0;t<e.length;t++){const r=e[t];r.group.sortPriority||r._onEndLayerSubtreeTraversal()}}_addRecursive(e){if(!e.visible)return;if(e.isLayer){const t=e;this._activeLayers.push(t),t._onBeginLayerSubtreeTraversal(this)}if(e!==this&&e.isStage){return void e.updateAsChildStage(this)}e._activeParentLayer=null;let t=e.parentGroup;t&&t._resolveChildDisplayObject(this,e);const r=e.parentLayer;if(r&&(t=r.group,t._resolveChildDisplayObject(this,e)),e.updateOrder=++_._updateOrderCounter,e.alpha<=0||!e.renderable||!e.layerableChildren||t&&t.sortPriority)return;const i=e.children;if(i&&i.length)for(let e=0;e<i.length;e++)this._addRecursive(i[e])}_addRecursiveChildren(e){if(e.alpha<=0||!e.renderable||!e.layerableChildren)return;const t=e.children;if(t&&t.length)for(let e=0;e<t.length;e++)this._addRecursive(t[e])}}_._updateOrderCounter=0,o(),c(r.Renderer),e.Group=p,e.Layer=y,e.LayerTextureCache=f,e.Stage=_,e.applyCanvasMixin=function(e){if(!e)return void console.log("@pixi/layers: Canvas mixin was called with empty parameter. Are you sure that you even need this line?");c(e);const r=t.Container.prototype;r.containerRenderCanvas||(r.containerRenderCanvas=r.renderCanvas,r.renderCanvas=l(r.renderCanvas))},e.applyContainerRenderMixin=function(e){e.originalRenderWebGL||(e.originalRenderWebGL=e.render,e.render=l(e.render),e.renderCanvas&&(e.originalRenderWebGL=e.renderCanvas,e.renderCanvas=l(e.renderCanvas)))},e.applyDisplayMixin=o,e.applyParticleMixin=function(e){e.prototype.layerableChildren=!1,this.applyRenderMixing(e)},e.applyRendererMixin=c,Object.defineProperty(e,"__esModule",{value:!0})})),"undefined"!=typeof _pixi_layers&&Object.assign(this.PIXI.display,_pixi_layers);
//# sourceMappingURL=pixi-layers.umd.min.js.map
